!function(t){"use strict";t.module("imageCropper",[])}(angular),function(t){"use strict";t.module("imageCropper").constant("defaultConfig",{width:400,height:300,zoomStep:.1,init:null,showControls:!0,fitOnInit:!1,controls:{rotateLeft:{title:"Rotate Left",className:"",id:"",content:" &lt; "},zoomOut:{title:"Zoom Out",className:"",id:"",content:" - "},fitImage:{title:"Fit Image",className:"",id:"",content:" [ ] "},zoomIn:{title:"Zoom In",className:"",id:"",content:" + "},rotateRight:{title:"Rotate Right",className:"",id:"",content:" &gt; "}}})}(angular),function(t){"use strict";function e(t){function e(t){return a.test(t.type)}function o(t){return e(t)?1===t.originalEvent.changedTouches.length:1===t.which}function n(t){return e(t)&&(t=t.originalEvent.touches[0]),{x:t.pageX,y:t.pageY}}function i(){if(null!==r)return r;var t,e,o,n,i,a,s,l,c;for(o=["webkit","Moz","O","ms","Khtml"],a={transform:"transform"},l=0,c=o.length;c>l;l++)e=o[l],a[e+"Transform"]="-"+e.toLowerCase()+"-transform";t=document.createElement("img"),document.body.insertBefore(t,null);for(i in a)if(n=a[i],void 0!==t.style[i]&&(t.style[i]="rotate(90deg)",s=window.getComputedStyle(t).getPropertyValue(n),null!==s&&s.length&&"none"!==s)){r=!0;break}return document.body.removeChild(t),r}var a=/touch/i,r=null,s={canTransform:i,getPointerPosition:n,isTouch:e,validEvent:o};return s}t.module("imageCropper").factory("Helper",e),e.$inject=["defaultConfig"]}(angular),function(t){"use strict";function e(t,e){function o(t,o,i,c){return a=document.createElement("canvas"),a.width=i,a.height=c,r=a.getContext("2d"),l=o,m=e.defer(),s=new Image,s.src=t.src,s.onload=n,m.promise}function n(){return r.save(),r.scale(l.scale,l.scale),r.rotate(l.angle*Math.PI/180),90===l.angle?(r.translate(0,-s.height),r.translate(-l.y/l.scale,l.x/l.scale)):180===l.angle?(r.translate(-s.width,-s.height),r.translate(l.x/l.scale,l.y/l.scale)):270===l.angle?(r.translate(-s.width,0),r.translate(l.y/l.scale,-l.x/l.scale)):r.translate(-l.x/l.scale,-l.y/l.scale),r.drawImage(s,0,0),r.restore(),c=a.toDataURL("image/jpeg"),m.resolve(c)}function i(){return c}var a,r,s,l,c,m,u={crop:o,get:i};return u}t.module("imageCropper").factory("Cropper",e),e.$inject=["Helper","$q"]}(angular),function(t){"use strict";function e(e,o,n){function i(i,a,r){var s=!1,l=t.element("body"),c=a.find("img"),m=a.find(".imgCropper-canvas"),u=a.find(".imgCropper-window"),g=i.controls;g?(g.rotateLeft=g.rotateLeft||o.controls.rotateLeft,g.zoomOut=g.zoomOut||o.controls.zoomOut,g.fitImage=g.fitImage||o.controls.fitImage,g.zoomIn=g.zoomIn||o.controls.zoomIn,g.rotateRight=g.rotateRight||o.controls.rotateRight):g=o.controls;var d,f,h,p,v,I={width:Number(i.destWidth)||o.width,height:Number(i.destHeight)||o.height,zoomStep:Number(i.zoomStep)||o.zoomStep,init:i.init||o.init,fitOnInit:i.fitOnInit||o.fitOnInit,controls:{rotateLeft:{title:g.rotateLeft.title||o.controls.rotateLeft.title,className:g.rotateLeft.className||o.controls.rotateLeft.className,id:g.rotateLeft.id||o.controls.rotateLeft.id},zoomOut:{title:g.zoomOut.title||o.controls.zoomOut.title,className:g.zoomOut.className||o.controls.zoomOut.className,id:g.zoomOut.id||o.controls.zoomOut.id},fitImage:{title:g.fitImage.title||o.controls.fitImage.title,className:g.fitImage.className||o.controls.fitImage.className,id:g.fitImage.id||o.controls.fitImage.id},zoomIn:{title:g.zoomIn.title||o.controls.zoomIn.title,className:g.zoomIn.className||o.controls.zoomIn.className,id:g.zoomIn.id||o.controls.zoomIn.id},rotateRight:{title:g.rotateRight.title||o.controls.rotateRight.title,className:g.rotateRight.className||o.controls.rotateRight.className,id:g.rotateRight.id||o.controls.rotateRight.id}}},z=1+I.zoomStep,y=1/z,w=I.height/I.width;d=f=h=p=v=0;var N,b={scale:1,angle:0,x:0,y:0,w:I.width,h:I.height},C={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},O=function(){d=c[0].naturalWidth/I.width,f=c[0].naturalHeight/I.height,m.css({width:100*d+"%",height:100*f+"%",top:0,left:0}),u.css({width:"100%",height:"auto","padding-top":I.height/I.width*100+"%"}),s=!0},R=function(t){return s&&n.validEvent(t)?(t.preventDefault(),t.stopImmediatePropagation(),N=n.getPointerPosition(t),L()):void 0},L=function(){return l.addClass("imgCropper-dragging"),m.on(C.move,P),m.on(C.stop,x)},x=function(t){l.removeClass("imgCropper-dragging"),m.off(C.move,P),m.off(C.stop,x)},k=function(t,e){return(t||0===t)&&(0>t&&(t=0),t>d-1&&(t=d-1),m[0].style.left=(100*-t).toFixed(2)+"%",h=t,b.x=Math.round(t*I.width)),(e||0===e)&&(0>e&&(e=0),e>f-1&&(e=f-1),m[0].style.top=(100*-e).toFixed(2)+"%",p=e,b.y=Math.round(e*I.height)),j()},P=function(t){var e,o,i,a,r;return t.preventDefault(),t.stopImmediatePropagation(),a=n.getPointerPosition(t),e=a.x-N.x,o=a.y-N.y,N=a,i=0===e?null:h-e/u[0].clientWidth,r=0===o?null:p-o/u[0].clientHeight,k(i,r)},H=function(t){var e,o,n,i;if(!(0>=t||1===t))return i=d,e=f,i*t>1&&e*t>1?(d*=t,f*=t,m[0].style.width=(100*d).toFixed(2)+"%",m[0].style.height=(100*f).toFixed(2)+"%",b.scale*=t):(E(),t=d/i),o=(h+.5)*t-.5,n=(p+.5)*t-.5,k(o,n)},E=function(){var t,e;return t=d,e=f/d,e>1?(d=1,f=e):(d=1/e,f=1),m[0].style.width=(100*d).toFixed(2)+"%",m[0].style.height=(100*f).toFixed(2)+"%",b.scale*=d/t,j()},F=function(){return k((d-1)/2,(f-1)/2)},S=function(t){var e,o,i,a,r,s;if(n.canTransform()&&0!==t&&t%90===0)return v=(v+t)%360,0>v&&(v=360+v),t%180!==0&&(a=[f*w,d/w],d=a[0],f=a[1],d>=1&&f>=1?(m[0].style.width=100*d+"%",m[0].style.height=100*f+"%"):E()),r=[1,1],i=r[0],o=r[1],v%180!==0&&(e=f/d*w,s=[e,1/e],i=s[0],o=s[1]),c[0].style.width=100*i+"%",c[0].style.height=100*o+"%",c[0].style.left=(1-i)/2*100+"%",c[0].style.top=(1-o)/2*100+"%",c.css({transform:"rotate("+v+"deg)"}),F(),b.angle=v,j()};i.rotateLeft=function(){S(-90)},i.rotateRight=function(){S(90)},i.center=function(){F()},i.fit=function(){E(),F()},i.zoomIn=function(){H(z)},i.zoomOut=function(){H(y),j()};var j=function(){e.crop(c[0],b,I.width,I.height).then(function(t){i.croppedImage=t})};c[0].onload=function(){var t=this;O(),T(c),t.naturalWidth<I.width||t.naturalHeight<I.height||I.fitOnInit?E():F(),a.find("img").on(C.start,R),j()};var T=function(e){return t.element(e).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}}return{restrict:"E",scope:{image:"@",destWidth:"@",destHeight:"@",zoomStep:"@",init:"@",croppedImage:"=",showControls:"=",fitOnInit:"=",controls:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div id="controls" ng-if="showControls">','<button type="button" ng-click="rotateLeft()" class="{{controls.rotateLeft.className}}" title="{{controls.rotateLeft.className}}" id="{{controls.rotateLeft.id}}"> &lt; </button>','<button type="button" ng-click="zoomOut()" class="{{controls.zoomOut.className}}" title="{{controls.zoomOut.className}}" id="{{controls.zoomOut.id}}"> - </button>','<button type="button" ng-click="fit()" class="{{controls.fitImage.className}}" title="{{controls.fitImage.className}}" id="{{controls.fitImage.id}}"> [ ] </button>','<button type="button" ng-click="zoomIn()" class="{{controls.zoomIn.className}}" title="{{controls.zoomIn.className}}" id="{{controls.zoomIn.id}}"> + </button>','<button type="button" ng-click="rotateRight()" class="{{controls.rotateRight.className}}" title="{{controls.rotateRight.className}}" id="{{controls.rotateRight.id}}"> &gt; </button>',"</div>"].join(""),link:i}}t.module("imageCropper").directive("imageCropper",e),e.$inject=["Cropper","defaultConfig","Helper"]}(angular);