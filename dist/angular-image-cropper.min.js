!function(t){"use strict";t.module("imageCropper",[])}(angular),function(t){"use strict";t.module("imageCropper").constant("defaultConfig",{width:400,height:300,zoomStep:.1,init:null,showControls:!0,fitOnInit:!1,controls:{rotateLeft:{title:"Rotate Left",className:""},zoomOut:{title:"Zoom Out",className:""},fitImage:{title:"Fit Image",className:""},zoomIn:{title:"Zoom In",className:""},rotateRight:{title:"Rotate Right",className:""}}})}(angular),function(t){"use strict";function e(t){function e(t){return a.test(t.type)}function o(t){return e(t)?1===t.originalEvent.changedTouches.length:1===t.which}function i(t){return e(t)&&(t=t.originalEvent.touches[0]),{x:t.pageX,y:t.pageY}}function n(){if(null!==r)return r;var t,e,o,i,n,a,s,l,c;for(o=["webkit","Moz","O","ms","Khtml"],a={transform:"transform"},l=0,c=o.length;c>l;l++)e=o[l],a[e+"Transform"]="-"+e.toLowerCase()+"-transform";t=document.createElement("img"),document.body.insertBefore(t,null);for(n in a)if(i=a[n],void 0!==t.style[n]&&(t.style[n]="rotate(90deg)",s=window.getComputedStyle(t).getPropertyValue(i),null!==s&&s.length&&"none"!==s)){r=!0;break}return document.body.removeChild(t),r}var a=/touch/i,r=null,s={canTransform:n,getPointerPosition:i,isTouch:e,validEvent:o};return s}t.module("imageCropper").factory("Helper",e),e.$inject=["defaultConfig"]}(angular),function(t){"use strict";function e(t,e){function o(t,o,n,c){return a=document.createElement("canvas"),a.width=n,a.height=c,r=a.getContext("2d"),l=o,m=e.defer(),s=new Image,s.src=t.src,s.onload=i,m.promise}function i(){return r.save(),r.scale(l.scale,l.scale),r.rotate(l.angle*Math.PI/180),90===l.angle?(r.translate(0,-s.height),r.translate(-l.y/l.scale,l.x/l.scale)):180===l.angle?(r.translate(-s.width,-s.height),r.translate(l.x/l.scale,l.y/l.scale)):270===l.angle?(r.translate(-s.width,0),r.translate(l.y/l.scale,-l.x/l.scale)):r.translate(-l.x/l.scale,-l.y/l.scale),r.drawImage(s,0,0),r.restore(),c=a.toDataURL("image/jpeg"),m.resolve(c)}function n(){return c}var a,r,s,l,c,m,u={crop:o,get:n};return u}t.module("imageCropper").factory("Cropper",e),e.$inject=["Helper","$q"]}(angular),function(t){"use strict";function e(e,o,i){function n(n,a,r){var s=!1,l=t.element("body"),c=a.find("img"),m=a.find(".imgCropper-canvas"),u=a.find(".imgCropper-window"),g=n.controls;g?(g.rotateLeft=g.rotateLeft||o.controls.rotateLeft,g.zoomOut=g.zoomOut||o.controls.zoomOut,g.fitImage=g.fitImage||o.controls.fitImage,g.zoomIn=g.zoomIn||o.controls.zoomIn,g.rotateRight=g.rotateRight||o.controls.rotateRight):g=o.controls;var f,h,d,p,v,y={width:Number(n.destWidth)||o.width,height:Number(n.destHeight)||o.height,zoomStep:Number(n.zoomStep)||o.zoomStep,init:n.init||o.init,fitOnInit:n.fitOnInit||o.fitOnInit,controls:{rotateLeft:{title:g.rotateLeft.title||o.controls.rotateLeft.title,className:g.rotateLeft.className||o.controls.rotateLeft.className},zoomOut:{title:g.zoomOut.title||o.controls.zoomOut.title,className:g.zoomOut.className||o.controls.zoomOut.className},fitImage:{title:g.fitImage.title||o.controls.fitImage.title,className:g.fitImage.className||o.controls.fitImage.className},zoomIn:{title:g.zoomIn.title||o.controls.zoomIn.title,className:g.zoomIn.className||o.controls.zoomIn.className},rotateRight:{title:g.rotateRight.title||o.controls.rotateRight.title,className:g.rotateRight.className||o.controls.rotateRight.className}}},w=1+y.zoomStep,I=1/w,b=y.height/y.width;f=h=d=p=v=0;var z,N={scale:1,angle:0,x:0,y:0,w:y.width,h:y.height},C={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},O=function(){f=c[0].naturalWidth/y.width,h=c[0].naturalHeight/y.height,m.css({width:100*f+"%",height:100*h+"%",top:0,left:0}),u.css({width:"100%",height:"auto","padding-top":y.height/y.width*100+"%"}),s=!0},R=function(t){return s&&i.validEvent(t)?(t.preventDefault(),t.stopImmediatePropagation(),z=i.getPointerPosition(t),x()):void 0},x=function(){return l.addClass("imgCropper-dragging"),m.on(C.move,P),m.on(C.stop,L)},L=function(t){l.removeClass("imgCropper-dragging"),m.off(C.move,P),m.off(C.stop,L)},k=function(t,e){return(t||0===t)&&(0>t&&(t=0),t>f-1&&(t=f-1),m[0].style.left=(100*-t).toFixed(2)+"%",d=t,N.x=Math.round(t*y.width)),(e||0===e)&&(0>e&&(e=0),e>h-1&&(e=h-1),m[0].style.top=(100*-e).toFixed(2)+"%",p=e,N.y=Math.round(e*y.height)),j()},P=function(t){var e,o,n,a,r;return t.preventDefault(),t.stopImmediatePropagation(),a=i.getPointerPosition(t),e=a.x-z.x,o=a.y-z.y,z=a,n=0===e?null:d-e/u[0].clientWidth,r=0===o?null:p-o/u[0].clientHeight,k(n,r)},F=function(t){var e,o,i,n;if(!(0>=t||1===t))return n=f,e=h,n*t>1&&e*t>1?(f*=t,h*=t,m[0].style.width=(100*f).toFixed(2)+"%",m[0].style.height=(100*h).toFixed(2)+"%",N.scale*=t):(H(),t=f/n),o=(d+.5)*t-.5,i=(p+.5)*t-.5,k(o,i)},H=function(){var t,e;return t=f,e=h/f,e>1?(f=1,h=e):(f=1/e,h=1),m[0].style.width=(100*f).toFixed(2)+"%",m[0].style.height=(100*h).toFixed(2)+"%",N.scale*=f/t,j()},E=function(){return k((f-1)/2,(h-1)/2)},S=function(t){var e,o,n,a,r,s;if(i.canTransform()&&0!==t&&t%90===0)return v=(v+t)%360,0>v&&(v=360+v),t%180!==0&&(a=[h*b,f/b],f=a[0],h=a[1],f>=1&&h>=1?(m[0].style.width=100*f+"%",m[0].style.height=100*h+"%"):H()),r=[1,1],n=r[0],o=r[1],v%180!==0&&(e=h/f*b,s=[e,1/e],n=s[0],o=s[1]),c[0].style.width=100*n+"%",c[0].style.height=100*o+"%",c[0].style.left=(1-n)/2*100+"%",c[0].style.top=(1-o)/2*100+"%",c.css({transform:"rotate("+v+"deg)"}),E(),N.angle=v,j()};n.rotateLeft=function(){S(-90)},n.rotateRight=function(){S(90)},n.center=function(){E()},n.fit=function(){H(),E()},n.zoomIn=function(){F(w)},n.zoomOut=function(){F(I),j()};var j=function(){e.crop(c[0],N,y.width,y.height).then(function(t){n.croppedImage=t})};c[0].onload=function(){var t=this;O(),T(c),t.naturalWidth<y.width||t.naturalHeight<y.height||y.fitOnInit?H():E(),a.find("img").on(C.start,R),j()};var T=function(e){return t.element(e).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}}return{restrict:"E",scope:{image:"@",destWidth:"@",destHeight:"@",zoomStep:"@",init:"@",croppedImage:"=",showControls:"=",fitOnInit:"=",controls:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div id="controls" ng-if="showControls">','<button ng-click="rotateLeft()" class="{{controls.rotateLeft.className}}" type="button" title="Rotate left" id="aic-rotate-left-buttom"> &lt; </button>','<button ng-click="zoomOut()" class="{{controls.zoomOut.className}}" type="button" title="Zoom out" id="aic-zoom-out-buttom"> - </button>','<button ng-click="fit()" class="{{controls.fitImage.className}}" type="button" title="Fit image" id="aic-fit-image-buttom"> [ ] </button>','<button ng-click="zoomIn()" class="{{controls.zoomIn.className}}" type="button" title="Zoom in" id="aic-zoom-in-buttom"> + </button>','<button ng-click="rotateRight()" class="{{controls.rotateRight.className}}" type="button" title="Rotate right" id="aic-rotate-left-buttom"> &gt; </button>',"</div>"].join(""),link:n}}t.module("imageCropper").directive("imageCropper",e),e.$inject=["Cropper","defaultConfig","Helper"]}(angular);